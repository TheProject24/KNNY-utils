<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KNNY Utils - Academic Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #4a5568;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #4a5568;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .btn-success {
            background: linear-gradient(135deg, #38a169, #2f855a);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        .items-grid {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .item-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .item-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .item-meta {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .item-description {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fed7d7;
            color: #c53030;
        }

        .status-submitted {
            background: #c6f6d5;
            color: #2f855a;
        }

        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-filter input {
            flex: 1;
            min-width: 200px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .tab-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>KNNY Utils</h1>
            <p class="subtitle">Academic Management System</p>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('assignments')">Assignments</button>
            <button class="tab-btn" onclick="showTab('lectures')">Lectures</button>
            <button class="tab-btn" onclick="showTab('links')">Links</button>
            <button class="tab-btn" onclick="showTab('snippets')">Code Snippets</button>
        </div>

        <!-- Assignments Tab -->
        <div id="assignments" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Assignments</h2>
            
            <form id="assignmentForm" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="assignmentCourse">Course</label>
                    <input type="text" id="assignmentCourse" required>
                </div>
                <div class="form-group">
                    <label for="assignmentInstruction">Instruction</label>
                    <textarea id="assignmentInstruction" required></textarea>
                </div>
                <div class="form-group">
                    <label for="assignmentDueDate">Due Date</label>
                    <input type="datetime-local" id="assignmentDueDate" required>
                </div>
                <button type="submit" class="btn">Add Assignment</button>
            </form>

            <div class="search-filter">
                <input type="text" id="assignmentSearch" placeholder="Search assignments...">
                <select id="assignmentFilter">
                    <option value="">All Assignments</option>
                    <option value="pending">Pending</option>
                    <option value="submitted">Submitted</option>
                </select>
            </div>

            <div id="assignmentsList" class="items-grid"></div>
        </div>

        <!-- Lectures Tab -->
        <div id="lectures" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Lectures</h2>
            
            <form id="lectureForm" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="lectureTitle">Title</label>
                    <input type="text" id="lectureTitle" required>
                </div>
                <div class="form-group">
                    <label for="lectureDescription">Description</label>
                    <textarea id="lectureDescription" required></textarea>
                </div>
                <button type="submit" class="btn">Add Lecture</button>
            </form>

            <div class="search-filter">
                <input type="text" id="lectureSearch" placeholder="Search lectures...">
            </div>

            <div id="lecturesList" class="items-grid"></div>
        </div>

        <!-- Links Tab -->
        <div id="links" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Links</h2>
            
            <form id="linkForm" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="linkTitle">Title</label>
                    <input type="text" id="linkTitle" required>
                </div>
                <div class="form-group">
                    <label for="linkUrl">URL</label>
                    <input type="url" id="linkUrl" required>
                </div>
                <div class="form-group">
                    <label for="linkTag">Tag</label>
                    <input type="text" id="linkTag" placeholder="Generic">
                </div>
                <button type="submit" class="btn">Add Link</button>
            </form>

            <div class="search-filter">
                <input type="text" id="linkSearch" placeholder="Search links...">
                <select id="linkTagFilter">
                    <option value="">All Tags</option>
                </select>
            </div>

            <div id="linksList" class="items-grid"></div>
        </div>

        <!-- Code Snippets Tab -->
        <div id="snippets" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2d3748;">Code Snippets</h2>
            
            <form id="snippetForm" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="snippetTitle">Title</label>
                    <input type="text" id="snippetTitle" placeholder="Code Snippet">
                </div>
                <div class="form-group">
                    <label for="snippetLanguage">Language</label>
                    <input type="text" id="snippetLanguage" required>
                </div>
                <div class="form-group">
                    <label for="snippetCode">Code</label>
                    <textarea id="snippetCode" required style="font-family: 'Courier New', monospace;"></textarea>
                </div>
                <div class="form-group">
                    <label for="snippetTags">Tags</label>
                    <input type="text" id="snippetTags" placeholder="Random">
                </div>
                <div class="form-group">
                    <label for="snippetDescription">Description</label>
                    <input type="text" id="snippetDescription" placeholder="No Description">
                </div>
                <button type="submit" class="btn">Add Snippet</button>
            </form>

            <div class="search-filter">
                <input type="text" id="snippetSearch" placeholder="Search snippets...">
            </div>

            <div id="snippetsList" class="items-grid"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://knny-utils-api.onrender.com/api';

        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for the selected tab
            loadData(tabName);
        }

        // API functions
        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                alert('Operation failed. Please try again.');
                throw error;
            }
        }

        // Assignments functions
        async function loadAssignments() {
            const container = document.getElementById('assignmentsList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading assignments...</div>';

            try {
                const assignments = await apiCall(`${API_BASE}/assignments`);
                displayAssignments(assignments);
            } catch (error) {
                container.innerHTML = '<div class="loading">Failed to load assignments</div>';
            }
        }

        function displayAssignments(assignments) {
            const container = document.getElementById('assignmentsList');
            
            if (assignments.length === 0) {
                container.innerHTML = '<div class="loading">No assignments found</div>';
                return;
            }

            container.innerHTML = assignments.map(assignment => `
                <div class="item-card">
                    <div class="item-title">${assignment.course}</div>
                    <div class="item-meta">
                        Due: ${new Date(assignment.dueDate).toLocaleDateString()}
                        <span class="status-badge ${assignment.submitted ? 'status-submitted' : 'status-pending'}">
                            ${assignment.submitted ? 'Submitted' : 'Pending'}
                        </span>
                    </div>
                    <div class="item-description">${assignment.instruction}</div>
                    <div class="item-actions">
                        ${!assignment.submitted ? `<button class="btn btn-success" onclick="submitAssignment('${assignment._id}')">Mark as Submitted</button>` : ''}
                        <button class="btn btn-warning" onclick="editAssignment('${assignment._id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteAssignment('${assignment._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function addAssignment(event) {
            event.preventDefault();
            
            const assignmentData = {
                course: document.getElementById('assignmentCourse').value,
                instruction: document.getElementById('assignmentInstruction').value,
                dueDate: document.getElementById('assignmentDueDate').value
            };

            try {
                await apiCall(`${API_BASE}/assignments`, {
                    method: 'POST',
                    body: JSON.stringify(assignmentData)
                });
                
                document.getElementById('assignmentForm').reset();
                loadAssignments();
            } catch (error) {
                console.error('Failed to add assignment:', error);
            }
        }

        async function submitAssignment(id) {
            try {
                await apiCall(`${API_BASE}/assignments/${id}/submit`, {
                    method: 'PATCH'
                });
                loadAssignments();
            } catch (error) {
                console.error('Failed to submit assignment:', error);
            }
        }

        async function deleteAssignment(id) {
            if (confirm('Are you sure you want to delete this assignment?')) {
                try {
                    await apiCall(`${API_BASE}/assignments/${id}`, {
                        method: 'DELETE'
                    });
                    loadAssignments();
                } catch (error) {
                    console.error('Failed to delete assignment:', error);
                }
            }
        }

        // Lectures functions
        async function loadLectures() {
            const container = document.getElementById('lecturesList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading lectures...</div>';

            try {
                const lectures = await apiCall(`${API_BASE}/lectures`);
                displayLectures(lectures);
            } catch (error) {
                container.innerHTML = '<div class="loading">Failed to load lectures</div>';
            }
        }

        function displayLectures(lectures) {
            const container = document.getElementById('lecturesList');
            
            if (lectures.length === 0) {
                container.innerHTML = '<div class="loading">No lectures found</div>';
                return;
            }

            container.innerHTML = lectures.map(lecture => `
                <div class="item-card">
                    <div class="item-title">${lecture.title}</div>
                    <div class="item-meta">Created: ${new Date(lecture.createdAt).toLocaleDateString()}</div>
                    <div class="item-description">${lecture.description}</div>
                    ${lecture.files && lecture.files.length > 0 ? `
                        <div style="margin: 15px 0;">
                            <strong>Files:</strong>
                            ${lecture.files.map(file => `<span class="tag">${file}</span>`).join(' ')}
                        </div>
                    ` : ''}
                    <div class="item-actions">
                        <button class="btn btn-warning" onclick="editLecture('${lecture._id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteLecture('${lecture._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function addLecture(event) {
            event.preventDefault();
            
            const lectureData = {
                title: document.getElementById('lectureTitle').value,
                description: document.getElementById('lectureDescription').value
            };

            try {
                await apiCall(`${API_BASE}/lectures`, {
                    method: 'POST',
                    body: JSON.stringify(lectureData)
                });
                
                document.getElementById('lectureForm').reset();
                loadLectures();
            } catch (error) {
                console.error('Failed to add lecture:', error);
            }
        }

        async function deleteLecture(id) {
            if (confirm('Are you sure you want to delete this lecture?')) {
                try {
                    await apiCall(`${API_BASE}/lectures/${id}`, {
                        method: 'DELETE'
                    });
                    loadLectures();
                } catch (error) {
                    console.error('Failed to delete lecture:', error);
                }
            }
        }

        // Links functions
        async function loadLinks() {
            const container = document.getElementById('linksList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading links...</div>';

            try {
                const links = await apiCall(`${API_BASE}/links`);
                displayLinks(links);
                populateLinkTags(links);
            } catch (error) {
                container.innerHTML = '<div class="loading">Failed to load links</div>';
            }
        }

        function displayLinks(links) {
            const container = document.getElementById('linksList');
            
            if (links.length === 0) {
                container.innerHTML = '<div class="loading">No links found</div>';
                return;
            }

            container.innerHTML = links.map(link => `
                <div class="item-card">
                    <div class="item-title">${link.title}</div>
                    <div class="item-description">
                        <a href="${link.url}" target="_blank" style="color: #667eea; text-decoration: none;">${link.url}</a>
                    </div>
                    <div style="margin: 15px 0;">
                        <span class="tag">${link.tag}</span>
                    </div>
                    <div class="item-actions">
                        <button class="btn" onclick="window.open('${link.url}', '_blank')">Open Link</button>
                        <button class="btn btn-warning" onclick="editLink('${link._id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteLink('${link._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function populateLinkTags(links) {
            const tagFilter = document.getElementById('linkTagFilter');
            const tags = [...new Set(links.map(link => link.tag))];
            
            tagFilter.innerHTML = '<option value="">All Tags</option>' + 
                tags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
        }

        async function addLink(event) {
            event.preventDefault();
            
            const linkData = {
                title: document.getElementById('linkTitle').value,
                url: document.getElementById('linkUrl').value,
                tag: document.getElementById('linkTag').value || 'Generic'
            };

            try {
                await apiCall(`${API_BASE}/links`, {
                    method: 'POST',
                    body: JSON.stringify(linkData)
                });
                
                document.getElementById('linkForm').reset();
                loadLinks();
            } catch (error) {
                console.error('Failed to add link:', error);
            }
        }

        async function deleteLink(id) {
            if (confirm('Are you sure you want to delete this link?')) {
                try {
                    await apiCall(`${API_BASE}/links/${id}`, {
                        method: 'DELETE'
                    });
                    loadLinks();
                } catch (error) {
                    console.error('Failed to delete link:', error);
                }
            }
        }

        // Snippets functions
        async function loadSnippets() {
            const container = document.getElementById('snippetsList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading snippets...</div>';

            try {
                const snippets = await apiCall(`${API_BASE}/snippets`);
                displaySnippets(snippets);
            } catch (error) {
                container.innerHTML = '<div class="loading">Failed to load snippets</div>';
            }
        }

        function displaySnippets(snippets) {
            const container = document.getElementById('snippetsList');
            
            if (snippets.length === 0) {
                container.innerHTML = '<div class="loading">No snippets found</div>';
                return;
            }

            container.innerHTML = snippets.map(snippet => `
                <div class="item-card">
                    <div class="item-title">${snippet.title}</div>
                    <div class="item-meta">
                        <span class="tag">${snippet.language}</span>
                        <span class="tag">${snippet.tags}</span>
                    </div>
                    <div class="item-description">${snippet.description}</div>
                    <pre><code>${snippet.code}</code></pre>
                    <div class="item-actions">
                        <button class="btn" onclick="copyToClipboard(\`${snippet.code.replace(/`/g, '\\`')}\`)">Copy Code</button>
                        <button class="btn btn-danger" onclick="deleteSnippet('${snippet._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function addSnippet(event) {
            event.preventDefault();
            
            const snippetData = {
                title: document.getElementById('snippetTitle').value || 'Code Snippet',
                language: document.getElementById('snippetLanguage').value,
                code: document.getElementById('snippetCode').value,
                tags: document.getElementById('snippetTags').value || 'Random',
                description: document.getElementById('snippetDescription').value || 'No Description'
            };

            try {
                await apiCall(`${API_BASE}/snippets`, {
                    method: 'POST',
                    body: JSON.stringify(snippetData)
                });
                
                document.getElementById('snippetForm').reset();
                loadSnippets();
            } catch (error) {
                console.error('Failed to add snippet:', error);
            }
        }

        async function deleteSnippet(id) {
            if (confirm('Are you sure you want to delete this snippet?')) {
                try {
                    await apiCall(`${API_BASE}/snippets/${id}`, {
                        method: 'DELETE'
                    });
                    loadSnippets();
                } catch (error) {
                    console.error('Failed to delete snippet:', error);
                }
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Code copied to clipboard!');
            });
        }

        // Search and filter functions
        function setupSearchAndFilter() {
            // Assignment search and filter
            document.getElementById('assignmentSearch').addEventListener('input', filterAssignments);
            document.getElementById('assignmentFilter').addEventListener('change', filterAssignments);
            
            // Lecture search
            document.getElementById('lectureSearch').addEventListener('input', filterLectures);
            
            // Link search
            document.getElementById('linkSearch').addEventListener('input', filterLinks);
            document.getElementById('linkTagFilter').addEventListener('change', filterLinks);
            
            // Snippet search
            document.getElementById('snippetSearch').addEventListener('input', filterSnippets);
        }

        function filterAssignments() {
            const searchTerm = document.getElementById('assignmentSearch').value.toLowerCase();
            const filterValue = document.getElementById('assignmentFilter').value;
            const cards = document.querySelectorAll('#assignmentsList .item-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                const matchesSearch = text.includes(searchTerm);
                const isSubmitted = card.querySelector('.status-submitted') !== null;
                const matchesFilter = !filterValue || 
                    (filterValue === 'submitted' && isSubmitted) ||
                    (filterValue === 'pending' && !isSubmitted);
                
                card.style.display = matchesSearch && matchesFilter ? 'block' : 'none';
            });
        }

        function filterLectures() {
            const searchTerm = document.getElementById('lectureSearch').value.toLowerCase();
            const cards = document.querySelectorAll('#lecturesList .item-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function filterLinks() {
            const searchTerm = document.getElementById('linkSearch').value.toLowerCase();
            const tagFilter = document.getElementById('linkTagFilter').value;
            const cards = document.querySelectorAll('#linksList .item-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                const tag = card.querySelector('.tag').textContent;
                const matchesSearch = text.includes(searchTerm);
                const matchesTag = !tagFilter || tag === tagFilter;
                
                card.style.display = matchesSearch && matchesTag ? 'block' : 'none';
            });
        }

        function filterSnippets() {
            const searchTerm = document.getElementById('snippetSearch').value.toLowerCase();
            const cards = document.querySelectorAll('#snippetsList .item-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        // Load data based on current tab
        function loadData(tabName) {
            switch(tabName) {
                case 'assignments':
                    loadAssignments();
                    break;
                case 'lectures':
                    loadLectures();
                    break;
                case 'links':
                    loadLinks();
                    break;
                case 'snippets':
                    loadSnippets();
                    break;
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Form event listeners
            document.getElementById('assignmentForm').addEventListener('submit', addAssignment);
            document.getElementById('lectureForm').addEventListener('submit', addLecture);
            document.getElementById('linkForm').addEventListener('submit', addLink);
            document.getElementById('snippetForm').addEventListener('submit', addSnippet);
            
            // Setup search and filter functionality
            setupSearchAndFilter();
            
            // Load initial data
            loadAssignments();
        });

        // Edit functions (simplified implementations)
        async function editAssignment(id) {
            try {
                const assignment = await apiCall(`${API_BASE}/assignments/${id}`);
                
                // Populate form with existing data
                document.getElementById('assignmentCourse').value = assignment.course;
                document.getElementById('assignmentInstruction').value = assignment.instruction;
                document.getElementById('assignmentDueDate').value = new Date(assignment.dueDate).toISOString().slice(0, 16);
                
                // Change form behavior to update instead of create
                const form = document.getElementById('assignmentForm');
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Update Assignment';
                submitBtn.style.background = 'linear-gradient(135deg, #ed8936, #dd6b20)';
                
                // Store the ID for update
                form.dataset.editId = id;
                
                // Scroll to form
                form.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Failed to load assignment for editing:', error);
            }
        }

        async function editLecture(id) {
            try {
                const lecture = await apiCall(`${API_BASE}/lectures/${id}`);
                
                document.getElementById('lectureTitle').value = lecture.title;
                document.getElementById('lectureDescription').value = lecture.description;
                
                const form = document.getElementById('lectureForm');
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Update Lecture';
                submitBtn.style.background = 'linear-gradient(135deg, #ed8936, #dd6b20)';
                
                form.dataset.editId = id;
                form.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Failed to load lecture for editing:', error);
            }
        }

        async function editLink(id) {
            try {
                const link = await apiCall(`${API_BASE}/links/${id}`);
                
                document.getElementById('linkTitle').value = link.title;
                document.getElementById('linkUrl').value = link.url;
                document.getElementById('linkTag').value = link.tag;
                
                const form = document.getElementById('linkForm');
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Update Link';
                submitBtn.style.background = 'linear-gradient(135deg, #ed8936, #dd6b20)';
                
                form.dataset.editId = id;
                form.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Failed to load link for editing:', error);
            }
        }

        // Update form submission handlers to handle both create and update
        async function addAssignment(event) {
            event.preventDefault();
            
            const form = event.target;
            const isEdit = form.dataset.editId;
            
            const assignmentData = {
                course: document.getElementById('assignmentCourse').value,
                instruction: document.getElementById('assignmentInstruction').value,
                dueDate: document.getElementById('assignmentDueDate').value
            };

            try {
                if (isEdit) {
                    await apiCall(`${API_BASE}/assignments/${isEdit}`, {
                        method: 'PATCH',
                        body: JSON.stringify(assignmentData)
                    });
                } else {
                    await apiCall(`${API_BASE}/assignments`, {
                        method: 'POST',
                        body: JSON.stringify(assignmentData)
                    });
                }
                
                // Reset form
                form.reset();
                delete form.dataset.editId;
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Add Assignment';
                submitBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                
                loadAssignments();
            } catch (error) {
                console.error('Failed to save assignment:', error);
            }
        }

        async function addLecture(event) {
            event.preventDefault();
            
            const form = event.target;
            const isEdit = form.dataset.editId;
            
            const lectureData = {
                title: document.getElementById('lectureTitle').value,
                description: document.getElementById('lectureDescription').value
            };

            try {
                if (isEdit) {
                    await apiCall(`${API_BASE}/lectures/${isEdit}`, {
                        method: 'PATCH',
                        body: JSON.stringify(lectureData)
                    });
                } else {
                    await apiCall(`${API_BASE}/lectures`, {
                        method: 'POST',
                        body: JSON.stringify(lectureData)
                    });
                }
                
                // Reset form
                form.reset();
                delete form.dataset.editId;
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Add Lecture';
                submitBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                
                loadLectures();
            } catch (error) {
                console.error('Failed to save lecture:', error);
            }
        }

        async function addLink(event) {
            event.preventDefault();
            
            const form = event.target;
            const isEdit = form.dataset.editId;
            
            const linkData = {
                title: document.getElementById('linkTitle').value,
                url: document.getElementById('linkUrl').value,
                tag: document.getElementById('linkTag').value || 'Generic'
            };

            try {
                if (isEdit) {
                    await apiCall(`${API_BASE}/links/${isEdit}`, {
                        method: 'PATCH',
                        body: JSON.stringify(linkData)
                    });
                } else {
                    await apiCall(`${API_BASE}/links`, {
                        method: 'POST',
                        body: JSON.stringify(linkData)
                    });
                }
                
                // Reset form
                form.reset();
                delete form.dataset.editId;
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Add Link';
                submitBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                
                loadLinks();
            } catch (error) {
                console.error('Failed to save link:', error);
            }
        }

        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function isOverdue(dueDate) {
            return new Date(dueDate) < new Date();
        }

        // Enhanced assignment display with overdue status
        function displayAssignments(assignments) {
            const container = document.getElementById('assignmentsList');
            
            if (assignments.length === 0) {
                container.innerHTML = '<div class="loading">No assignments found</div>';
                return;
            }

            container.innerHTML = assignments.map(assignment => {
                const overdue = !assignment.submitted && isOverdue(assignment.dueDate);
                return `
                    <div class="item-card" style="border-left-color: ${overdue ? '#e53e3e' : assignment.submitted ? '#38a169' : '#667eea'}">
                        <div class="item-title">${assignment.course}</div>
                        <div class="item-meta">
                            Due: ${formatDate(assignment.dueDate)}
                            ${overdue ? '<span style="color: #e53e3e; font-weight: bold;">⚠️ OVERDUE</span>' : ''}
                            <span class="status-badge ${assignment.submitted ? 'status-submitted' : 'status-pending'}">
                                ${assignment.submitted ? 'Submitted' : 'Pending'}
                            </span>
                        </div>
                        <div class="item-description">${assignment.instruction}</div>
                        <div class="item-actions">
                            ${!assignment.submitted ? `<button class="btn btn-success" onclick="submitAssignment('${assignment._id}')">Mark as Submitted</button>` : ''}
                            <button class="btn btn-warning" onclick="editAssignment('${assignment._id}')">Edit</button>
                            <button class="btn btn-danger" onclick="deleteAssignment('${assignment._id}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Enhanced error handling
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            // You can add user-friendly error messages here
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl/Cmd + 1-4 for tab switching
            if ((event.ctrlKey || event.metaKey) && event.key >= '1' && event.key <= '4') {
                event.preventDefault();
                const tabs = ['assignments', 'lectures', 'links', 'snippets'];
                const tabIndex = parseInt(event.key) - 1;
                if (tabs[tabIndex]) {
                    showTab(tabs[tabIndex]);
                    document.querySelector(`button[onclick="showTab('${tabs[tabIndex]}')"]`).click();
                }
            }
        });

        // Auto-refresh data every 5 minutes
        setInterval(() => {
            const activeTab = document.querySelector('.tab-content.active').id;
            loadData(activeTab);
        }, 300000); // 5 minutes

        console.log('KNNY Utils Frontend loaded successfully!');
    </script>
</body>
</html>